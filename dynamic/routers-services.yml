http:
  routers:
    # === Redirection globale HTTP -> HTTPS (tous hôtes) ===
    http-catchall:
      entryPoints: [ web ]
      rule: HostRegexp(`{any:.+}`)
      middlewares: [ redirect-https ]
      service: noop

    # === FULLSTACK-DEV.COM ===
    # www.fullstack-dev.com -> site IIS (port 80)
    fullstack_www:
      entryPoints: [ websecure ]
      rule: Host(`cd.fullstack-dev.com`)
      service: svc_fullstack_cd
      middlewares: [ gzip, hsts ]
      tls:
        certResolver: le

    traefik-dashboard:
      entryPoints: [ "websecure" ]
      rule: "Host(`traefik.fullstack-dev.com`)"
      service: "api@internal"
      tls:
        certResolver: "le"
      middlewares: [ "auth", "hsts" ]

    eboutique_wildcard:
      entryPoints: [ "websecure" ]
      rule: "HostRegexp(`{subdomain:.+}.eboutique.asdpromo.com`)"
      service: "svc_eboutique_iis"
      middlewares: [ "gzip", "hsts" ]
      tls:
        certResolver: "le"

  services:
    # === Cibles IIS pour FULLSTACK-DEV ===
    svc_fullstack_cd:
      loadBalancer:
        passHostHeader: true
        servers:
          - url: "https://win-cm1c9g1gt4m:501"

    svc_eboutique_iis:
      loadBalancer:
        passHostHeader: true         # ✅ conserve le Host original
        servers:
          - url: "https://win-cm1c9g1gt4m"   # ✅ URL de ton IIS interne (port 80 ou autre)

    # Service bidon pour la redirection HTTP->HTTPS
    noop:
      loadBalancer:
        servers:
          - url: "http://127.0.0.1"